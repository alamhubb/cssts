# cssts-compiler LLM å¼€å‘æŒ‡å—

> æœ¬æ–‡æ¡£é¢å‘ AI åŠ©æ‰‹ï¼Œå¸®åŠ©ç†è§£å’Œå¼€å‘ cssts-compiler é¡¹ç›®

## 1. é¡¹ç›®æ¦‚è¿°

cssts-compiler æ˜¯ä¸€ä¸ª CSS-in-TS ç¼–è¯‘å™¨ï¼Œå°† `css { }` è¯­æ³•è½¬æ¢ä¸ºè¿è¡Œæ—¶å¯ç”¨çš„ JavaScript ä»£ç ã€‚

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- è§£æ `.cssts` æ–‡ä»¶ä¸­çš„ `css { }` è¯­æ³•
- CST â†’ AST è½¬æ¢ï¼Œç”Ÿæˆ `cssts.$cls(csstsAtom.xxx, ...)` è°ƒç”¨
- æŒ‰éœ€ç”Ÿæˆ CSS æ ·å¼
- ç”Ÿæˆ `.d.ts` ç±»å‹å®šä¹‰ä¾› IDE æç¤º

---

## 2. ç”¨æˆ· vs å¼€å‘è€…

### ç”¨æˆ·ï¼ˆä½¿ç”¨ cssts çš„é¡¹ç›®ï¼‰

ç”¨æˆ·é€šè¿‡ `vite-plugin-cssts` ä½¿ç”¨ï¼Œ**é›¶é…ç½®**ï¼š

```bash
npm install vite-plugin-cssts -D
```

```javascript
// vite.config.js
import cssTsPlugin from 'vite-plugin-cssts'
export default { plugins: [cssTsPlugin(), vue()] }
```

ç”¨æˆ·ä¸éœ€è¦æ‰§è¡Œä»»ä½• cssts-compiler è„šæœ¬ï¼Œæ‰€æœ‰å·¥ä½œç”± Vite æ’ä»¶è‡ªåŠ¨å®Œæˆã€‚

### å¼€å‘è€…ï¼ˆå¼€å‘ cssts-compilerï¼‰

å¼€å‘è€…éœ€è¦äº†è§£ä»¥ä¸‹å†…å®¹ï¼š

---

## 3. æ—¥å¸¸å¼€å‘å·¥ä½œæµ

### ğŸ“‹ å¤§å¤šæ•°æ—¶å€™ä¸éœ€è¦æ‰§è¡Œä»»ä½•è„šæœ¬ï¼

ç›´æ¥ä¿®æ”¹æºç ï¼Œä½¿ç”¨ `mono` å¯åŠ¨ vite-project æµ‹è¯•ï¼š

```bash
cd cssts/vite-project
mono ./node_modules/vite/bin/vite.js
```

`mono` ä¼šè‡ªåŠ¨è§£ææœ¬åœ°æºç ï¼Œæ— éœ€æ„å»ºã€‚

### ğŸ§ª æµ‹è¯•ç¼–è¯‘ç»“æœ

```bash
cd cssts/vite-project
mono test-compiler.mjs
```

è¯¥è„šæœ¬ä¼šæ˜¾ç¤ºï¼šåŸå§‹ä»£ç ã€ç¼–è¯‘åä»£ç ã€æ”¶é›†çš„æ ·å¼ã€‚

---

## 4. é¡¹ç›®ç»“æ„

```
cssts-compiler/
â”œâ”€â”€ generator/               # æ•°æ®ç”Ÿæˆè„šæœ¬ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰
â”‚   â”œâ”€â”€ datajson/            # åŸå§‹æ•°æ® JSON
â”‚   â”œâ”€â”€ generator-data.ts    # ç”Ÿæˆ src/data/
â”‚   â””â”€â”€ generator-type.ts    # ç”Ÿæˆ src/config/types/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ parser/              # è§£æå™¨ï¼ˆç»§æ‰¿ slime-parserï¼‰
â”‚   â”œâ”€â”€ factory/             # CST â†’ AST è½¬æ¢å™¨
â”‚   â”œâ”€â”€ transform/           # æ ¸å¿ƒè½¬æ¢ + CSS ç”Ÿæˆ
â”‚   â”œâ”€â”€ dts/                 # ç±»å‹å®šä¹‰ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ data/                # è‡ªåŠ¨ç”Ÿæˆçš„æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ config/              # é…ç½®ç³»ç»Ÿ
â”‚   â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
â””â”€â”€ tests/                   # æµ‹è¯•æ–‡ä»¶
```

### å¼€å‘æ—¶å¸¸ç”¨ç›®å½•

| ç›®å½• | ä¿®æ”¹åœºæ™¯ |
|------|---------|
| `src/parser/` | ä¿®æ”¹ `css {}` è¯­æ³•è§£æè§„åˆ™ |
| `src/factory/` | ä¿®æ”¹ CSTâ†’AST è½¬æ¢é€»è¾‘ |
| `src/transform/` | ä¿®æ”¹ CSS ç”Ÿæˆ/è½¬æ¢å…¥å£ |
| `src/dts/` | ä¿®æ”¹ç±»å‹å®šä¹‰ç”Ÿæˆé€»è¾‘ |
| `src/utils/` | ä¿®æ”¹ CSS ç±»åè§„åˆ™ã€é…ç½®å·¥å…· |
| `generator/datajson/` | ä¿®æ”¹åŸå§‹æ•°æ®ï¼ˆä¼ªç±»ã€ç»§æ‰¿ç­‰ï¼‰ |

---

## 5. ç¼–è¯‘æµç¨‹ï¼ˆ4ä¸ªé˜¶æ®µï¼‰

```
æºä»£ç : const btn = css { displayFlex, colorRed }
         â†“
â‘  CssTsParser.Program()          â†’ CST
         â†“
â‘¡ CssTsCstToAstUtils.toFileAst() â†’ AST + usedAtoms
         â†“
â‘¢ SlimeGenerator.generator()      â†’ JavaScript
         â†“
â‘£ generateStylesCss()             â†’ CSS
```

è¯¦ç»†è¯´æ˜ï¼š
- **é˜¶æ®µ1 è§£æ**: CssTsParser ç»§æ‰¿ SlimeParserï¼Œæ·»åŠ  CssExpression è¯­æ³•
- **é˜¶æ®µ2 è½¬æ¢**: CssTsCstToAst æ‹¦æˆª CssExpressionï¼Œè½¬æ¢ä¸º cssts.$cls() è°ƒç”¨
- **é˜¶æ®µ3 ç”Ÿæˆ**: SlimeGenerator å°† AST è½¬å› JavaScript ä»£ç 
- **é˜¶æ®µ4 CSS**: generateStylesCss æ ¹æ®æ”¶é›†çš„æ ·å¼åç”Ÿæˆ CSS

---

## 6. Generator è„šæœ¬è¯¦è§£

### æ•°æ®æµå‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    csstree      â”‚     â”‚   datajson/     â”‚
â”‚  (npm åº“)       â”‚     â”‚  (æ‰‹åŠ¨ç»´æŠ¤)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ generator-data.ts   â”‚  â†’ src/data/*.ts
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ generator-type.ts   â”‚  â†’ src/config/types/*.d.ts
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### datajson/ ç›®å½•ï¼ˆæ‰‹åŠ¨ç»´æŠ¤ï¼‰

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `numberMapping.json` | å•ä½â†’åˆ†ç±»æ˜ å°„ï¼ˆpxâ†’pixel, emâ†’fontRelativeï¼‰ |
| `pseudo-standards.json` | ä¼ªç±»åˆ—è¡¨ï¼ˆhover, focusï¼‰å’Œä¼ªå…ƒç´ ï¼ˆbefore, afterï¼‰ |
| `propertyInheritance.json` | å±æ€§ç®€å†™ç»§æ‰¿ï¼ˆmâ†’margin, mxâ†’marginLeft+marginRightï¼‰ |

### ä½•æ—¶æ‰§è¡Œ

| åœºæ™¯ | æ‰§è¡Œè„šæœ¬ |
|------|---------|
| å‡çº§ csstree ç‰ˆæœ¬ | ä¸¤ä¸ªè„šæœ¬éƒ½æ‰§è¡Œ |
| æ·»åŠ æ–°ä¼ªç±» | ä¿®æ”¹ pseudo-standards.json åæ‰§è¡Œä¸¤ä¸ªè„šæœ¬ |
| ä¿®æ”¹å•ä½åˆ†ç±» | ä¿®æ”¹ numberMapping.json åæ‰§è¡Œä¸¤ä¸ªè„šæœ¬ |
| æ·»åŠ å±æ€§ç»§æ‰¿ | ä¿®æ”¹ propertyInheritance.json åæ‰§è¡Œä¸¤ä¸ªè„šæœ¬ |

### æ‰§è¡Œé¡ºåºï¼ˆå¿…é¡»æŒ‰é¡ºåºï¼‰

```bash
cd cssts/cssts/cssts-compiler

# 1. å…ˆç”Ÿæˆæ•°æ®ï¼ˆè¯»å– csstree + datajson â†’ src/data/ï¼‰
tsx generator/generator-data.ts

# 2. å†ç”Ÿæˆç±»å‹ï¼ˆè¯»å– src/data/ â†’ src/config/types/ï¼‰
tsx generator/generator-type.ts

# 3. éªŒè¯æ„å»º
npm run build
```

### ç”Ÿæˆçš„æ–‡ä»¶

**src/data/** (ç”± generator-data.ts ç”Ÿæˆ)ï¼š
- `cssPropertyNameMapping.ts` - å±æ€§åæ˜ å°„
- `cssKeywordsData.ts` - å…³é”®å­—æ•°æ®
- `cssColorData.ts` - é¢œè‰²æ•°æ®
- `cssPseudoData.ts` - ä¼ªç±»/ä¼ªå…ƒç´ æ•°æ®
- `cssNumberData.ts` - å•ä½å’Œåˆ†ç±»
- `cssPropertyKeywords.ts` - å±æ€§â†’å…³é”®å­—æ˜ å°„
- `cssPropertyNumber.ts` - å±æ€§â†’æ•°å€¼åˆ†ç±»æ˜ å°„
- `cssPropertyColorTypes.ts` - å±æ€§â†’é¢œè‰²ç±»å‹æ˜ å°„
- `cssPropertyInheritance.ts` - å±æ€§ç»§æ‰¿å…³ç³»

**src/config/types/** (ç”± generator-type.ts ç”Ÿæˆ)ï¼š
- `cssPropertyConfig.d.ts` - CSS å±æ€§é…ç½®ç±»å‹
- `csstsConfig.d.ts` - CsstsConfig æ¥å£

---

## 7. å…³é”®è®¾è®¡å†³ç­–

| å†³ç­– | åŸå›  |
|------|------|
| ç»§æ‰¿ slime-parser | å¤ç”¨æˆç†Ÿçš„ TS/JS è§£æå™¨ï¼Œåªéœ€æ·»åŠ  `css { }` è¯­æ³• |
| å…¨å±€æ³¨å†Œæœºåˆ¶ | è®©å­ç±»èƒ½è¦†ç›–è½¬æ¢é€»è¾‘ï¼Œè§£å†³ç»§æ‰¿æ—¶å†…éƒ¨è°ƒç”¨ä¸èµ°å­ç±»çš„é—®é¢˜ |
| åŸå­ç±»æŒ‰éœ€æ”¶é›† | åªç”Ÿæˆå®é™…ä½¿ç”¨çš„ CSSï¼Œå‡å°‘æ‰“åŒ…ä½“ç§¯ |
| ä¼ªç±»ç”¨ `$$` åˆ†éš” | é¿å…ä¸ JS å˜é‡å‘½åå†²çªï¼ˆ`$` æ˜¯åˆæ³•æ ‡è¯†ç¬¦ï¼‰ |

---

## 8. å¸¸è§é—®é¢˜ä¿®å¤æŒ‡å—

### é—®é¢˜ï¼šcss { } è¯­æ³•æ— æ³•è§£æ

**æ£€æŸ¥ç‚¹**ï¼š
1. CssTsParser æ˜¯å¦æ­£ç¡®ç»§æ‰¿ SlimeParser
2. CssExpression è¯­æ³•è§„åˆ™æ˜¯å¦å®šä¹‰
3. CssTsTokenConsumer æ˜¯å¦åŒ…å« `css` å…³é”®å­—

### é—®é¢˜ï¼šè½¬æ¢åä»£ç ä¸¢å¤± TypeScript ç±»å‹

**æ£€æŸ¥ç‚¹**ï¼š
1. SlimeGenerator æ˜¯å¦å¤„ç†äº†ç›¸å…³ AST èŠ‚ç‚¹
2. æ£€æŸ¥ `generatorCallExpression` æ˜¯å¦è¾“å‡º `typeParameters`
3. æ£€æŸ¥ CSTâ†’AST è½¬æ¢æ˜¯å¦ä¿ç•™äº† `typeParameters` å­—æ®µ

### é—®é¢˜ï¼šç”Ÿæˆçš„ CSS ç±»åä¸æ­£ç¡®

**æ£€æŸ¥ç‚¹**ï¼š
1. `utils/cssClassName.ts` ä¸­çš„ `getCssClassName` å‡½æ•°
2. æ£€æŸ¥ camelCase â†’ kebab-case è½¬æ¢é€»è¾‘
3. æ£€æŸ¥ç‰¹æ®Šå­—ç¬¦å¤„ç†ï¼ˆå°æ•°ç‚¹ã€ç™¾åˆ†å·ã€è´Ÿæ•°ï¼‰

### é—®é¢˜ï¼šIDE æ— æ³•è‡ªåŠ¨è¡¥å…¨åŸå­ç±»

**æ£€æŸ¥ç‚¹**ï¼š
1. ç±»å‹å®šä¹‰æ˜¯å¦ç”Ÿæˆåˆ° `node_modules/@types/cssts-ts/`
2. `tsconfig.json` æ˜¯å¦åŒ…å« `@types` ç›®å½•
3. æ£€æŸ¥ `dts/atom-generator.ts` ç”Ÿæˆé€»è¾‘

---

## 9. æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | èŒè´£ |
|------|------|
| `parser/CssTsParser.ts` | è§£æå™¨ï¼Œæ·»åŠ  css {} è¯­æ³• |
| `factory/CssTsCstToAstUtils.ts` | CSTâ†’AST è½¬æ¢ï¼Œæ‹¦æˆª CssExpression |
| `transform/index.ts` | æ ¸å¿ƒè½¬æ¢å…¥å£ï¼ŒCSS ç”Ÿæˆ |
| `dts/atom-generator.ts` | åŸå­ç±»å®šä¹‰ç”Ÿæˆ |
| `dts/dts-writer.ts` | ç±»å‹æ–‡ä»¶å†™å…¥ |
| `utils/cssClassName.ts` | CSS ç±»åç”Ÿæˆè§„åˆ™ |
| `config/CsstsDefaultConfig.ts` | é»˜è®¤é…ç½® |

---

## 10. ä¾èµ–å…³ç³»

```
slime-parser (JS/TS è§£æå™¨)
    â†“ ç»§æ‰¿
cssts-compiler (æœ¬é¡¹ç›®)
    â†“ è¢«ä½¿ç”¨
vite-plugin-cssts (Vite æ’ä»¶)
    â†“ å®‰è£…
ç”¨æˆ·é¡¹ç›®
```

---

## 11. è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹ CST ç»“æ„

```typescript
const parser = new CssTsParser(code)
const cst = parser.Program()
console.log(JSON.stringify(cst, null, 2))
```

### æŸ¥çœ‹ AST ç»“æ„

```typescript
const ast = CssTsCstToAstUtils.toFileAst(cst)
console.log(JSON.stringify(ast, null, 2))
```

### æŸ¥çœ‹æ”¶é›†çš„æ ·å¼

```typescript
const usedAtoms = CssTsCstToAstUtils.getUsedAtoms()
console.log([...usedAtoms])
```

### æµ‹è¯•ç¼–è¯‘è¾“å‡º

```bash
# åœ¨ vite-project ä¸­
mono test-compiler.mjs
```

---

## 12. ç‰ˆæœ¬å…¼å®¹

- Node.js >= 18
- slime-parser >= 0.2.x
- slime-generator >= 0.2.x

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸è¦æ‰‹åŠ¨ç¼–è¾‘ `src/data/` æ–‡ä»¶** - è¿™äº›ç”± `generator-data.ts` è‡ªåŠ¨ç”Ÿæˆ
2. **ä¸è¦æ‰‹åŠ¨ç¼–è¾‘ `src/config/types/` æ–‡ä»¶** - è¿™äº›ç”± `generator-type.ts` è‡ªåŠ¨ç”Ÿæˆ
3. **ä¿®æ”¹åæµ‹è¯•** - ä½¿ç”¨ `mono test-compiler.mjs` éªŒè¯ç¼–è¯‘è¾“å‡º
4. **å‘å¸ƒå‰æ„å»º** - æ‰§è¡Œ `npm run build` ç”Ÿæˆå‘å¸ƒåŒ…
