# CSSTS æ¶æ„è®¾è®¡

> è¿è¡Œæ—¶ã€ç¼–è¯‘å™¨ã€Vite æ’ä»¶ä¹‹é—´çš„åä½œå…³ç³»

## âš ï¸ é‡è¦ï¼šä¼ªç±»åˆ†éš”ç¬¦æ˜¯åŒç¾å…ƒç¬¦å· `$$`

**ä¼ªç±»è¯­æ³•ä½¿ç”¨åŒç¾å…ƒç¬¦å· `$$`ï¼Œä¸æ˜¯å•ç¾å…ƒç¬¦å· `$`ï¼**

```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨åŒç¾å…ƒç¬¦å· $$
const primary$$hover$$active = css { backgroundColorBlue }

// âŒ é”™è¯¯ï¼šä½¿ç”¨å•ç¾å…ƒç¬¦å· $ï¼ˆä¼ªç±»ä¸ä¼šç”Ÿæ•ˆï¼ï¼‰
const primary$hover$active = css { backgroundColorBlue }
```

åˆ†éš”ç¬¦é…ç½®æ¥è‡ª `cssts-runtime`ï¼š

```typescript
import { CSSTS_CONFIG } from 'cssts-ts'
console.log(CSSTS_CONFIG.PSEUDO_SEPARATOR)  // '$$'
```

---

## CSS è¯­æ³•è¯´æ˜

### æ”¯æŒçš„è¯­æ³•ï¼šCSS è¡¨è¾¾å¼

CSSTS åªæ”¯æŒ **css è¡¨è¾¾å¼è¯­æ³•**ï¼Œå¯ä»¥åœ¨ä»»ä½•è¡¨è¾¾å¼ä½ç½®ä½¿ç”¨ï¼š

```typescript
// âœ… æ”¯æŒï¼šcss è¡¨è¾¾å¼
const buttonBase = css { colorRed, fontBold }
const styles = { primary: css { bgPrimary } }
div(class = css { primaryButton, marginTop }) {}
```

### ä¸æ”¯æŒçš„è¯­æ³•ï¼šCSS å£°æ˜

**ä¸æ”¯æŒ** css å£°æ˜è¯­æ³•ï¼ˆå¦‚ `css colorRed`ï¼‰ï¼š

```typescript
// âŒ ä¸æ”¯æŒï¼šcss å£°æ˜è¯­æ³•
css colorRed  // è¿™ç§è¯­æ³•ä¸è¢«æ”¯æŒ
```

### è®¾è®¡åŸå› 

å£°æ˜è¯­æ³•éœ€è¦é‡å†™ `Statement` å’Œ `Declaration` è§„åˆ™ï¼Œä¼šå¯¼è‡´ä¸æ ‡å‡† JavaScript è¯­æ³•å†²çªã€‚ä¾‹å¦‚ï¼š

```typescript
// å¦‚æœæ”¯æŒ css å£°æ˜è¯­æ³•ï¼Œä¼šç ´å async function çš„è§£æ
async function foo() {}  // å¯èƒ½è¢«è¯¯è§£æ
```

è¡¨è¾¾å¼è¯­æ³•æ›´çµæ´»ï¼Œä¸ä¼šç ´å JS å…¼å®¹æ€§ï¼Œæ¨èä½¿ç”¨ã€‚

## æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           æºä»£ç æ–‡ä»¶                                     â”‚
â”‚  .cssts æ–‡ä»¶ / .ovs æ–‡ä»¶                                                â”‚
â”‚  const style = css { displayFlex, colorRed }                            â”‚
â”‚  const btn$$hover$$active = css { cursorPointer }                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Vite æ’ä»¶å±‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   vite-plugin-cssts     â”‚    â”‚   vite-plugin-ovs       â”‚            â”‚
â”‚  â”‚   å¤„ç† .cssts æ–‡ä»¶       â”‚    â”‚   å¤„ç† .ovs æ–‡ä»¶         â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚              â”‚                              â”‚                           â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                         â”‚                                               â”‚
â”‚                         â–¼                                               â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚              â”‚  sharedStyles: Set<string>                               â”‚
â”‚              â”‚  å…±äº«çš„æ ·å¼æ”¶é›†å™¨                                          â”‚
â”‚              â”‚  å­˜å‚¨æ‰€æœ‰åŸå­ç±»å                                          â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç¼–è¯‘å™¨å±‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  cssts-compiler                                                  â”‚   â”‚
â”‚  â”‚  â€¢ CssTsCstToAst: CST â†’ AST è½¬æ¢                                 â”‚   â”‚
â”‚  â”‚  â€¢ æ”¶é›† usedAtomsï¼ˆåŸå­ç±»åï¼‰                                     â”‚   â”‚
â”‚  â”‚  â€¢ ç”Ÿæˆ cssts.$cls(csstsAtom.xxx) è°ƒç”¨                           â”‚   â”‚
â”‚  â”‚  â€¢ ç”Ÿæˆ CSS è§„åˆ™                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â–²                                          â”‚
â”‚                              â”‚ ç»§æ‰¿                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ovs-compiler                                                    â”‚   â”‚
â”‚  â”‚  â€¢ OvsCstToSlimeAst extends CssTsCstToAst                        â”‚   â”‚
â”‚  â”‚  â€¢ å¤ç”¨çˆ¶ç±»çš„ css {} è¯­æ³•å¤„ç†                                     â”‚   â”‚
â”‚  â”‚  â€¢ è°ƒç”¨ processCsstsPostTransform() æ·»åŠ å¯¼å…¥                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          è¿è¡Œæ—¶å±‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  cssts-runtime                                                   â”‚   â”‚
â”‚  â”‚  â€¢ $cls(): åˆå¹¶æ ·å¼å¯¹è±¡                                           â”‚   â”‚
â”‚  â”‚  â€¢ replace(): å±æ€§å†²çªæ£€æµ‹ + æ›¿æ¢                                 â”‚   â”‚
â”‚  â”‚  â€¢ CSSTS_CONFIG: åˆ†éš”ç¬¦é…ç½®                                       â”‚   â”‚
â”‚  â”‚    - SEPARATOR: '_' (å±æ€§_å€¼)                                    â”‚   â”‚
â”‚  â”‚    - PSEUDO_SEPARATOR: '$$' (å˜é‡å$$ä¼ªç±»)                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           è¾“å‡º                                          â”‚
â”‚  â€¢ JS: import { cssts } from 'cssts-ts'                                 â”‚
â”‚        import { csstsAtom } from 'virtual:csstsAtom'                   â”‚
â”‚        const style = cssts.$cls(csstsAtom.displayFlex, ...)            â”‚
â”‚                                                                         â”‚
â”‚  â€¢ CSS: .display_flex { display: flex; }                               â”‚
â”‚         .btn:hover { opacity: 0.9; }                                   â”‚
â”‚         .btn:active { opacity: 0.6; }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒè®¾è®¡ï¼šå…±äº«æ ·å¼æ”¶é›†å™¨

### é—®é¢˜

- `.cssts` æ–‡ä»¶ç”± `vite-plugin-cssts` å¤„ç†
- `.ovs` æ–‡ä»¶ç”± `vite-plugin-ovs` å¤„ç†
- ä¸¤ç§æ–‡ä»¶éƒ½å¯èƒ½ä½¿ç”¨ `css {}` è¯­æ³•
- éœ€è¦ç»Ÿä¸€æ”¶é›†æ‰€æœ‰æ ·å¼ï¼Œç”Ÿæˆå®Œæ•´çš„ CSS

### è§£å†³æ–¹æ¡ˆ

ä½¿ç”¨å…±äº«çš„ `Set<string>` ä½œä¸ºæ ·å¼æ”¶é›†å™¨ï¼š

```typescript
// vite-plugin-ovs åˆ›å»ºå…±äº« Set
const sharedStyles = new Set<string>()

// ä¼ ç»™ cssts æ’ä»¶
cssTsPlugin({ globalStyles: sharedStyles })

// ä¼ ç»™ ovs è½¬æ¢å‡½æ•°
vitePluginOvsTransform(code, { globalStyles: sharedStyles })
```

### æ•°æ®æµ

1. **vite-plugin-cssts** å¤„ç† `.cssts` æ–‡ä»¶æ—¶ï¼Œè°ƒç”¨ `transformCssTs()`ï¼Œæ”¶é›†æ ·å¼åˆ° `globalStyles`
2. **vite-plugin-ovs** å¤„ç† `.ovs` æ–‡ä»¶æ—¶ï¼Œè°ƒç”¨ `vitePluginOvsTransform()`ï¼Œæ”¶é›†æ ·å¼åˆ°åŒä¸€ä¸ª `globalStyles`
3. è™šæ‹Ÿæ¨¡å— `virtual:cssts.css` ä» `globalStyles` è¯»å–æ‰€æœ‰æ ·å¼ï¼Œç”Ÿæˆ CSS
4. è™šæ‹Ÿæ¨¡å— `virtual:csstsAtom` ä» `globalStyles` è¯»å–æ‰€æœ‰æ ·å¼ï¼Œç”ŸæˆåŸå­ç±»å¯¹è±¡

## ç»§æ‰¿å…³ç³»

```
SlimeCstToAst (slime-parser)
       â”‚
       â–¼
CssTsCstToAst (cssts-compiler)
  â€¢ createLexicalBindingAst() - æ”¶é›† $$ å˜é‡
  â€¢ createCssExpressionAst() - å¤„ç† css {} è¯­æ³•
  â€¢ processCsstsPostTransform() - æ·»åŠ  cssts å¯¼å…¥
       â”‚
       â–¼
OvsCstToSlimeAst (ovs-compiler)
  â€¢ toProgram() - é‡å†™ï¼Œå¤„ç† OVS è¯­æ³•
  â€¢ è°ƒç”¨ processCsstsPostTransform() - å¤ç”¨çˆ¶ç±»çš„ cssts å¤„ç†
  â€¢ å¤„ç† OVS ç‰¹æœ‰çš„å¯¼å…¥ï¼ˆ$OvsHtmlTag ç­‰ï¼‰
```

## åˆ†éš”ç¬¦é…ç½®

ç»Ÿä¸€åœ¨ `cssts-runtime` ä¸­é…ç½®ï¼š

```typescript
export const CSSTS_CONFIG = {
  // CSS ç±»ååˆ†éš”ç¬¦ï¼šproperty_value
  SEPARATOR: '_',
  
  // ä¼ªç±»åˆ†éš”ç¬¦ï¼ˆåŒç¾å…ƒç¬¦å·ï¼‰ï¼šbaseName$$pseudo1$$pseudo2
  PSEUDO_SEPARATOR: '$$',
}
```

### ä½¿ç”¨ç¤ºä¾‹

```typescript
// å˜é‡åï¼ˆä½¿ç”¨åŒç¾å…ƒç¬¦å· $$ åˆ†éš”ä¼ªç±»ï¼‰
const btn$$hover$$active = css { cursorPointer }

// è§£æ
parseStyleName('btn$$hover$$active')
// { baseName: 'btn', pseudos: ['hover', 'active'] }

// ç”Ÿæˆçš„ CSS
// .cursor_pointer { cursor: pointer; }
// .btn:hover { opacity: 0.9; }      â† æ¥è‡ª pseudoUtils é…ç½®
// .btn:active { opacity: 0.6; }     â† æ¥è‡ª pseudoUtils é…ç½®
```


## è‡ªåŠ¨è§£æ„ï¼šä½œç”¨åŸŸåˆ†æ + å‘½åè§„åˆ™

### é—®é¢˜èƒŒæ™¯

åœ¨ `css { }` è¡¨è¾¾å¼ä¸­ï¼Œç”¨æˆ·å¯èƒ½æ··åˆä½¿ç”¨åŸå­ç±»åå’Œå˜é‡ï¼š

```typescript
const baseStyles = css { colorRed, fontBold }
const primary = css { baseStyles, backgroundBlue }  // baseStyles æ˜¯å˜é‡ï¼Œä¸æ˜¯åŸå­ç±»
```

ç¼–è¯‘å™¨éœ€è¦åŒºåˆ†ï¼š
- **åŸå­ç±»å**ï¼ˆå¦‚ `colorRed`ï¼‰â†’ è½¬æ¢ä¸º `csstsAtom.colorRed`
- **å˜é‡å¼•ç”¨**ï¼ˆå¦‚ `baseStyles`ï¼‰â†’ ä¿æŒåŸæ ·ï¼Œè¿è¡Œæ—¶è‡ªåŠ¨è§£æ„

### è§£å†³æ–¹æ¡ˆï¼šä½œç”¨åŸŸåˆ†æ + å‘½åè§„åˆ™

é‡‡ç”¨ä¸¤å±‚åˆ¤æ–­æœºåˆ¶ï¼š

```
css { xxx } å†…çš„æ ‡è¯†ç¬¦åˆ¤æ–­æµç¨‹ï¼š

1. å…ˆæŸ¥ä½œç”¨åŸŸï¼šxxx åœ¨å½“å‰ä½œç”¨åŸŸä¸­å£°æ˜è¿‡å—ï¼Ÿ
   â”œâ”€ æ˜¯ â†’ ä¿æŒåŸæ ·ï¼ˆæ˜¯å˜é‡æˆ–å¯¼å…¥ï¼‰
   â””â”€ å¦ â†’ ç»§ç»­åˆ¤æ–­

2. å†æŸ¥å‘½åè§„åˆ™ï¼šparseTsAtomName(xxx) èƒ½è§£æå—ï¼Ÿ
   â”œâ”€ èƒ½ â†’ è½¬æ¢ä¸º csstsAtom.xxxï¼ˆæ˜¯åŸå­ç±»ï¼‰
   â””â”€ ä¸èƒ½ â†’ ä¿æŒåŸæ ·ï¼ˆæœªçŸ¥æ ‡è¯†ç¬¦ï¼‰
```

### ä½œç”¨åŸŸæ”¶é›†

åœ¨ CST éå†è¿‡ç¨‹ä¸­å®æ—¶æ”¶é›†ï¼š

1. **Import å£°æ˜**ï¼š`import { someStyle } from './styles'` â†’ æ”¶é›† `someStyle`
2. **å˜é‡å£°æ˜**ï¼š`const baseStyles = ...` â†’ æ”¶é›† `baseStyles`
3. **å‡½æ•°å‚æ•°**ï¼š`function foo(style) {}` â†’ æ”¶é›† `style`
4. **å—çº§ä½œç”¨åŸŸ**ï¼šè¿›å…¥ `{}` æ—¶ push æ–°ä½œç”¨åŸŸï¼Œç¦»å¼€æ—¶ pop

### å‘½åè§„åˆ™åˆ¤æ–­

ä½¿ç”¨ `parseTsAtomName()` å‡½æ•°åˆ¤æ–­æ˜¯å¦ç¬¦åˆåŸå­ç±»å‘½åè§„åˆ™ï¼š

```typescript
parseTsAtomName('colorRed')      // { property: 'color', value: 'red' } âœ“
parseTsAtomName('displayFlex')   // { property: 'display', value: 'flex' } âœ“
parseTsAtomName('baseStyles')    // null âœ— (ä¸ä»¥ CSS å±æ€§åå¼€å¤´)
parseTsAtomName('myVariable')    // null âœ—
```

### è®¾è®¡åŸå› 

1. **ä½œç”¨åŸŸä¼˜å…ˆ**ï¼šç¡®ä¿ç”¨æˆ·å£°æ˜çš„å˜é‡ä¸ä¼šè¢«è¯¯è½¬æ¢
2. **å‘½åè§„åˆ™å…œåº•**ï¼šå¯¹äºä¸åœ¨ä½œç”¨åŸŸä¸­çš„æ ‡è¯†ç¬¦ï¼Œç”¨å‘½åè§„åˆ™åˆ¤æ–­æ˜¯å¦æ˜¯åŸå­ç±»
3. **ä¸€ééå†**ï¼šä½œç”¨åŸŸåˆ†ææ˜¯å®æ—¶çš„ï¼Œä¸éœ€è¦ä¸¤ééå†
4. **å®‰å…¨é™çº§**ï¼šä¸ç¬¦åˆä»»ä½•è§„åˆ™çš„æ ‡è¯†ç¬¦ä¿æŒåŸæ ·ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯

### ç¤ºä¾‹

```typescript
import { sharedStyle } from './shared'

const baseStyles = css { colorRed, fontBold }
const primary = css { baseStyles, backgroundBlue, sharedStyle, unknownThing }
```

| æ ‡è¯†ç¬¦ | ä½œç”¨åŸŸæ£€æŸ¥ | å‘½åè§„åˆ™æ£€æŸ¥ | ç»“æœ |
|--------|-----------|-------------|------|
| `colorRed` | âœ— ä¸åœ¨ä½œç”¨åŸŸ | âœ“ èƒ½è§£æ | `csstsAtom.colorRed` |
| `fontBold` | âœ— ä¸åœ¨ä½œç”¨åŸŸ | âœ“ èƒ½è§£æ | `csstsAtom.fontBold` |
| `baseStyles` | âœ“ åœ¨ä½œç”¨åŸŸä¸­ | - | ä¿æŒåŸæ · |
| `backgroundBlue` | âœ— ä¸åœ¨ä½œç”¨åŸŸ | âœ“ èƒ½è§£æ | `csstsAtom.backgroundBlue` |
| `sharedStyle` | âœ“ åœ¨ä½œç”¨åŸŸä¸­ï¼ˆimportï¼‰ | - | ä¿æŒåŸæ · |
| `unknownThing` | âœ— ä¸åœ¨ä½œç”¨åŸŸ | âœ— ä¸èƒ½è§£æ | ä¿æŒåŸæ · |

### è¿è¡Œæ—¶æ”¯æŒ

`$cls()` å‡½æ•°å·²æ”¯æŒé€’å½’è§£æ„å¯¹è±¡ï¼š

```typescript
// è¿è¡Œæ—¶ processValue å‡½æ•°
function processValue(value: ClassValue, result: ClassObject): void {
  // ...
  if (typeof value === 'object') {
    for (const [key, val] of Object.entries(value)) {
      if (val) {
        if (typeof val === 'object' && val !== null) {
          processValue(val as ClassValue, result)  // é€’å½’è§£æ„
        } else {
          result[key] = true
        }
      }
    }
  }
}
```

æ‰€ä»¥ `cssts.$cls(baseStyles, csstsAtom.backgroundBlue)` ä¼šæ­£ç¡®åˆå¹¶ `baseStyles` å¯¹è±¡ä¸­çš„æ‰€æœ‰æ ·å¼ã€‚

## è™šæ‹Ÿæ¨¡å—

### virtual:cssts.css

ç”Ÿæˆæ‰€æœ‰åŸå­ç±»çš„ CSS è§„åˆ™ï¼š

```css
.display_flex { display: flex; }
.color_red { color: red; }
.btn:hover { opacity: 0.9; }
.btn:active { opacity: 0.6; }
```

### virtual:csstsAtom

ç”ŸæˆåŸå­ç±»å¯¹è±¡æ˜ å°„ï¼š

```typescript
export const csstsAtom = {
  displayFlex: { 'display_flex': true },
  colorRed: { 'color_red': true },
  // ...
}
```

## é…ç½®ç¤ºä¾‹

```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import ovs from 'vite-plugin-ovs'

export default defineConfig({
  plugins: [
    ovs({
      cssts: {
        pseudoUtils: {
          hover: { opacity: '0.9' },
          active: { opacity: '0.6' },
          focus: { outline: '2px solid #79bbff' },
          disabled: { opacity: '0.5', cursor: 'not-allowed' }
        }
      }
    })
  ]
})
```

## Vite ä¸¤é˜¶æ®µå¤„ç†æ¶æ„

### ä¸ºä»€ä¹ˆéœ€è¦å¤„ç†ä¸¤ä¸ªé˜¶æ®µï¼Ÿ

Vite å¯åŠ¨æ—¶æœ‰ä¸¤ä¸ªå…³é”®é˜¶æ®µï¼š

```
1. ä¾èµ–é¢„æ„å»ºï¼ˆoptimizeDepsï¼‰  â† esbuild ç›´æ¥è§£ææ–‡ä»¶
2. æ–‡ä»¶è½¬æ¢ï¼ˆtransformï¼‰       â† Vite æ’ä»¶åœ¨è¿™é‡Œå·¥ä½œ
```

**é—®é¢˜**ï¼šesbuild åœ¨ä¾èµ–é¢„æ„å»ºé˜¶æ®µä¼šè§£æ `.vue` æ–‡ä»¶æ¥åˆ†æ import è¯­å¥ï¼Œä½†å®ƒä¸è®¤è¯† `css {}` è¯­æ³•ï¼Œä¼šæŠ¥é”™ï¼š

```
Expected ";" but found "{"
const baseStyles = css {
                      ^
```

### è§£å†³æ–¹æ¡ˆï¼šä¸€ä¸ªæ’ä»¶ï¼Œä¸¤é˜¶æ®µå¤„ç†

`vite-plugin-cssts` é€šè¿‡ `config` é’©å­è‡ªåŠ¨æ³¨å…¥ esbuild æ’ä»¶ï¼ŒåŒæ—¶å¤„ç†ä¸¤ä¸ªé˜¶æ®µï¼š

```
æºæ–‡ä»¶ (VueButton.vue)
    â”‚
    â”œâ”€â†’ esbuild ä¾èµ–æ‰«æï¼ˆå†…å­˜ä¸­ï¼Œåªè¯»ï¼‰
    â”‚     â””â”€ cssts esbuild æ’ä»¶ï¼šcss {} â†’ {}ï¼ˆç®€å•æ›¿æ¢ï¼‰
    â”‚     â””â”€ esbuild è§£æ import è¯­å¥
    â”‚     â””â”€ ç»“æœç”¨äºä¾èµ–åˆ†æï¼Œç„¶åä¸¢å¼ƒ
    â”‚
    â””â”€â†’ Vite transformï¼ˆå†…å­˜ä¸­ï¼‰
          â””â”€ cssts Vite æ’ä»¶ï¼šæ­£ç¡®è½¬æ¢ css {} è¯­æ³•
          â””â”€ ç”Ÿæˆæ ·å¼ç±»åå’Œ CSS
          â””â”€ è¿”å›ç»™æµè§ˆå™¨
```

**å…³é”®ç‚¹**ï¼š
- ä¸¤ä¸ªé˜¶æ®µéƒ½æ˜¯**ç‹¬ç«‹è¯»å–æºæ–‡ä»¶**ï¼Œäº’ä¸å½±å“
- esbuild é˜¶æ®µçš„å¤„ç†**ä¸ä¼šä¿®æ”¹ç£ç›˜ä¸Šçš„æºæ–‡ä»¶**
- esbuild é˜¶æ®µåªéœ€è¦è®©è¯­æ³•åˆæ³•å³å¯ï¼ŒçœŸæ­£çš„è½¬æ¢åœ¨ transform é˜¶æ®µ

### æ’ä»¶å®ç°

```typescript
export default function cssTsPlugin(options): Plugin {
  return {
    name: 'vite-plugin-cssts',
    enforce: 'pre',

    // 1. é€šè¿‡ config é’©å­æ³¨å…¥ esbuild æ’ä»¶
    config() {
      return {
        optimizeDeps: {
          esbuildOptions: {
            plugins: [{
              name: 'cssts-esbuild',
              setup(build) {
                // å¤„ç† .vue æ–‡ä»¶ï¼Œå°† css {} æ›¿æ¢ä¸º {}
                build.onLoad({ filter: /\.vue$/ }, async (args) => {
                  const code = fs.readFileSync(args.path, 'utf-8')
                  if (!hasCssSyntax(code)) return null
                  
                  const transformed = code.replace(/css\s*\{[^}]*\}/g, '{}')
                  return { contents: transformed, loader: 'text' }
                })
              }
            }]
          }
        }
      }
    },

    // 2. æ­£å¸¸çš„ transform å¤„ç†
    transform(code, id) {
      // çœŸæ­£è½¬æ¢ css {} è¯­æ³•
    }
  }
}
```

### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

1. **ç”¨æˆ·ä½“éªŒ**ï¼šåªéœ€é…ç½®ä¸€ä¸ªæ’ä»¶ï¼Œä¸éœ€è¦æ‰‹åŠ¨é…ç½® esbuild
2. **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šesbuild é˜¶æ®µåªåš"è®©è¯­æ³•åˆæ³•"ï¼Œtransform é˜¶æ®µåš"æ­£ç¡®è½¬æ¢"
3. **ä¸å½±å“æºç **ï¼šæ‰€æœ‰å¤„ç†éƒ½åœ¨å†…å­˜ä¸­ï¼Œæºæ–‡ä»¶ä¿æŒä¸å˜

---

## æ–‡ä»¶å¤„ç†æµç¨‹

### .cssts æ–‡ä»¶

```
Button.cssts
    â”‚
    â–¼ vite-plugin-cssts.transform()
    â”‚
    â”œâ”€â–º transformCssTs(code, { styles: globalStyles })
    â”‚   â€¢ è§£æ css {} è¯­æ³•
    â”‚   â€¢ æ”¶é›†åŸå­ç±»ååˆ° globalStyles
    â”‚   â€¢ è½¬æ¢ä¸º cssts.$cls() è°ƒç”¨
    â”‚
    â””â”€â–º æ³¨å…¥ import 'virtual:cssts.css'
```

### .ovs æ–‡ä»¶

```
Button.ovs
    â”‚
    â–¼ vite-plugin-ovs.transform()
    â”‚
    â”œâ”€â–º vitePluginOvsTransform(code, { globalStyles: sharedStyles })
    â”‚   â€¢ OvsCstToSlimeAst.toProgram()
    â”‚     - å¤„ç† OVS è¯­æ³•ï¼ˆdiv {}, view ç­‰ï¼‰
    â”‚     - å¤„ç† css {} è¯­æ³•ï¼ˆç»§æ‰¿è‡ª CssTsCstToAstï¼‰
    â”‚     - æ”¶é›† usedAtoms
    â”‚   â€¢ å†™å…¥ sharedStyles
    â”‚
    â””â”€â–º æ³¨å…¥ import 'virtual:cssts.css'
```

### .vue æ–‡ä»¶ï¼ˆä½¿ç”¨ `<script lang="cssts">`ï¼‰

**é‡è¦**ï¼šåªæœ‰ `<script lang="cssts">` æ‰ä¼šè¢«å¤„ç†ï¼Œæ™®é€šçš„ `<script>` æˆ– `<script lang="ts">` ä¸æ”¯æŒ `css {}` è¯­æ³•ã€‚

```
Button.vue (åŒ…å« <script lang="cssts">)
    â”‚
    â”œâ”€â–º esbuild ä¾èµ–æ‰«æé˜¶æ®µï¼ˆå†…å­˜ä¸­ï¼‰
    â”‚   â€¢ cssts esbuild æ’ä»¶æ‹¦æˆª
    â”‚   â€¢ æ£€æµ‹åˆ° <script lang="cssts">
    â”‚   â€¢ å°† css {} æ›¿æ¢ä¸º {}ï¼Œå°† lang="cssts" æ”¹ä¸º lang="ts"
    â”‚   â€¢ ç»“æœåªç”¨äºä¾èµ–åˆ†æï¼Œä¸ä¿å­˜
    â”‚
    â””â”€â–º Vite transform é˜¶æ®µï¼ˆå†…å­˜ä¸­ï¼‰
        â”‚
        â–¼ vite-plugin-cssts.transform()
        â”‚
        â”œâ”€â–º æ£€æµ‹ <script lang="cssts">ï¼ˆæ™®é€š script ä¸å¤„ç†ï¼‰
        â”œâ”€â–º æå– <script lang="cssts"> å†…å®¹
        â”œâ”€â–º transformCssTs(scriptContent, { styles: globalStyles })
        â”‚   â€¢ è§£æ css {} è¯­æ³•
        â”‚   â€¢ æ”¶é›†åŸå­ç±»ååˆ° globalStyles
        â”‚   â€¢ è½¬æ¢ä¸º cssts.$cls() è°ƒç”¨
        â”œâ”€â–º é‡å»º .vue æ–‡ä»¶
        â”‚   â€¢ æ›¿æ¢ <script> å†…å®¹
        â”‚   â€¢ å°† lang="cssts" æ”¹ä¸º lang="ts"ï¼ˆè®© Vue ç¼–è¯‘å™¨èƒ½å¤„ç†ï¼‰
        â”‚
        â””â”€â–º æ³¨å…¥ import 'virtual:cssts.css'
```

**ä¸ºä»€ä¹ˆè¦å°† `lang="cssts"` æ”¹ä¸º `lang="ts"`ï¼Ÿ**

å› ä¸º Vue ç¼–è¯‘å™¨ä¸è®¤è¯† `lang="cssts"`ï¼Œå¦‚æœä¿æŒåŸæ ·ä¼šæŠ¥é”™ã€‚vite-plugin-cssts è®¾ç½®äº† `enforce: 'pre'`ï¼Œä¼šåœ¨ Vue æ’ä»¶ä¹‹å‰æ‰§è¡Œï¼Œè½¬æ¢å Vue çœ‹åˆ°çš„å°±æ˜¯æ ‡å‡†çš„ `<script lang="ts">`ã€‚


## å¸¸è§é—®é¢˜ä¸ä¿®å¤è®°å½•

### é—®é¢˜ 1ï¼šåŒ…åå¯¼å…¥é”™è¯¯

**é—®é¢˜æè¿°**ï¼š
`cssts-compiler` ä¸­å¯¼å…¥ `CSSTS_CONFIG` æ—¶ä½¿ç”¨äº†é”™è¯¯çš„åŒ…åã€‚

**é”™è¯¯ä»£ç **ï¼š
```typescript
// âŒ é”™è¯¯ï¼šåŒ…åä¸å­˜åœ¨
import { CSSTS_CONFIG } from "cssts-runtime"
```

**æ­£ç¡®ä»£ç **ï¼š
```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨å®é™…çš„åŒ…å
import { CSSTS_CONFIG } from "cssts-ts"
```

**é—®é¢˜åŸå› **ï¼š
- `cssts-runtime` åŒ…çš„ `package.json` ä¸­ `name` å­—æ®µæ˜¯ `"cssts-ts"`ï¼Œä¸æ˜¯ `"cssts-runtime"`
- ç›®å½•åå’ŒåŒ…åä¸ä¸€è‡´ï¼Œå®¹æ˜“æ··æ·†
- åœ¨ monorepo ä¸­ï¼Œworkspace é“¾æ¥ä½¿ç”¨çš„æ˜¯ `package.json` ä¸­çš„ `name` å­—æ®µ

**å¦‚ä½•é¿å…**ï¼š
1. å¯¼å…¥å‰æ£€æŸ¥ç›®æ ‡åŒ…çš„ `package.json` ä¸­çš„ `name` å­—æ®µ
2. åŒ…ç›®å½•ååº”ä¸ `package.json` ä¸­çš„ `name` ä¿æŒä¸€è‡´
3. åœ¨ monorepo ä¸­ï¼Œä½¿ç”¨ `npm ls` æˆ–æŸ¥çœ‹ `node_modules` ä¸­çš„ç¬¦å·é“¾æ¥ç¡®è®¤åŒ…å

**ç›¸å…³æ–‡ä»¶**ï¼š
- `cssts/packages/cssts-runtime/package.json` - åŒ…åå®šä¹‰ä¸º `"cssts"`
- `cssts/packages/cssts-compiler/src/utils/cssClassName.ts` - å¯¼å…¥ `CSSTS_CONFIG`

---

### é—®é¢˜ 2ï¼šä¼ªç±»åˆ†éš”ç¬¦ä½¿ç”¨é”™è¯¯

**é—®é¢˜æè¿°**ï¼š
ç»„ä»¶ä»£ç ä¸­ä½¿ç”¨çš„ä¼ªç±»åˆ†éš”ç¬¦ä¸é…ç½®ä¸åŒ¹é…ï¼Œå¯¼è‡´ä¼ªç±»æ ·å¼ä¸ç”Ÿæ•ˆã€‚

**é”™è¯¯ç¤ºä¾‹**ï¼š
```typescript
// é…ç½®ä¸­å®šä¹‰çš„åˆ†éš”ç¬¦æ˜¯åŒç¾å…ƒç¬¦å·
CSSTS_CONFIG.PSEUDO_SEPARATOR = '$$'

// ç»„ä»¶ä¸­é”™è¯¯ä½¿ç”¨å•ç¾å…ƒç¬¦å·
const primary$hover$active = css { ... }  // âŒ ä¸åŒ¹é…ï¼Œä¼ªç±»ä¸ç”Ÿæ•ˆ
```

**æ­£ç¡®ç¤ºä¾‹**ï¼š
```typescript
// é…ç½®ä¸­å®šä¹‰çš„åˆ†éš”ç¬¦æ˜¯åŒç¾å…ƒç¬¦å·
CSSTS_CONFIG.PSEUDO_SEPARATOR = '$$'

// ç»„ä»¶ä¸­ä½¿ç”¨åŒç¾å…ƒç¬¦å·
const primary$$hover$$active = css { ... }  // âœ… åŒ¹é…ï¼Œä¼ªç±»ç”Ÿæ•ˆ
```

**é—®é¢˜åŸå› **ï¼š
- `CSSTS_CONFIG.PSEUDO_SEPARATOR` çš„å€¼å†³å®šäº†ç¼–è¯‘å™¨å¦‚ä½•è§£æå˜é‡åä¸­çš„ä¼ªç±»
- å¦‚æœç»„ä»¶ä»£ç ä½¿ç”¨çš„åˆ†éš”ç¬¦ä¸é…ç½®ä¸åŒ¹é…ï¼Œç¼–è¯‘å™¨æ— æ³•è¯†åˆ«ä¼ªç±»éƒ¨åˆ†
- ä¼ªç±»æ ·å¼ä¸ä¼šè¢«ç”Ÿæˆï¼Œhover/active ç­‰æ•ˆæœå¤±æ•ˆ

**å¦‚ä½•é¿å…**ï¼š
1. åœ¨ç¼–å†™ç»„ä»¶å‰ï¼Œå…ˆç¡®è®¤ `CSSTS_CONFIG.PSEUDO_SEPARATOR` çš„å€¼ï¼ˆå½“å‰æ˜¯ `$$`ï¼‰
2. ä¿æŒå›¢é˜Ÿå†…åˆ†éš”ç¬¦ä½¿ç”¨çš„ä¸€è‡´æ€§
3. åœ¨æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜å½“å‰ä½¿ç”¨çš„åˆ†éš”ç¬¦

**å½“å‰é…ç½®**ï¼š
```typescript
// cssts-runtime/src/index.ts
export const CSSTS_CONFIG = {
  SEPARATOR: '_',           // CSS ç±»ååˆ†éš”ç¬¦ï¼šproperty_value
  PSEUDO_SEPARATOR: '$$',   // ä¼ªç±»åˆ†éš”ç¬¦ï¼šbaseName$$pseudo1$$pseudo2
}
```

**ä¼ªç±»è¯­æ³•ç¤ºä¾‹**ï¼š
```typescript
// å•ä¸ªä¼ªç±»
const btn$$hover = css { cursorPointer }
// ç”Ÿæˆï¼š.btn:hover { filter: brightness(1.15); }

// å¤šä¸ªä¼ªç±»
const primary$$hover$$active = css { backgroundColorBlue }
// ç”Ÿæˆï¼š
// .primary:hover { filter: brightness(1.15); }
// .primary:active { filter: brightness(0.85); }
```

**ç›¸å…³æ–‡ä»¶**ï¼š
- `cssts/packages/cssts-runtime/src/index.ts` - `CSSTS_CONFIG` å®šä¹‰
- `cssts/packages/cssts-compiler/src/factory/CssTsCstToAst.ts` - ä¼ªç±»è§£æé€»è¾‘
- `vite.config.ts` - `pseudoUtils` é…ç½®ä¼ªç±»æ•ˆæœ

---

### è°ƒè¯•æŠ€å·§

**æ£€æŸ¥ä¼ªç±»æ ·å¼æ˜¯å¦ç”Ÿæ•ˆ**ï¼š

1. æ‰“å¼€æµè§ˆå™¨ DevTools
2. åœ¨ Console ä¸­è¿è¡Œï¼š
```javascript
// æŸ¥æ‰¾æ‰€æœ‰ :hover å’Œ :active è§„åˆ™
for (const sheet of document.styleSheets) {
  try {
    for (const rule of sheet.cssRules) {
      if (rule.selectorText?.includes(':hover') || 
          rule.selectorText?.includes(':active')) {
        console.log(rule.selectorText, rule.style.cssText)
      }
    }
  } catch (e) {}
}
```

3. æ£€æŸ¥æ˜¯å¦æœ‰ç±»ä¼¼ä»¥ä¸‹çš„è§„åˆ™ï¼š
```css
.primary:hover { filter: brightness(1.15); }
.primary:active { filter: brightness(0.85); }
```

**æ£€æŸ¥å…ƒç´ çš„ class å±æ€§**ï¼š
```javascript
document.querySelector('button').className
// åº”è¯¥åŒ…å«åŸºç¡€ç±»åï¼Œå¦‚ "primary display_inline-flex ..."
```


---

## cssts-language åŒ…

### æ¦‚è¿°

`cssts-language` æ˜¯ä¸€ä¸ª VSCode æ‰©å±•ï¼Œä¸º `.cssts` æ–‡ä»¶æä¾›è¯­è¨€æœåŠ¡æ”¯æŒï¼ˆLSPï¼‰ã€‚åŸºäº [Volar](https://github.com/volarjs/volar.js) æ¡†æ¶æ„å»ºã€‚

### ä¸ cssts-compiler çš„å…³ç³»

`cssts-language` ä½¿ç”¨ `cssts-compiler` çš„ `transformCssTs` å‡½æ•°è¿›è¡Œä»£ç è½¬æ¢ï¼Œç¡®ä¿ï¼š

- ç¼–è¾‘å™¨ä¸­çš„è¯­æ³•æ£€æŸ¥ä¸ Vite æ„å»ºæ—¶ä¸€è‡´
- ä»£ç è¡¥å…¨åŸºäºå®é™…çš„è½¬æ¢ç»“æœ
- é”™è¯¯æç¤ºå‡†ç¡®åæ˜ ç¼–è¯‘é—®é¢˜

### åŠŸèƒ½

- **è¯­æ³•é«˜äº®**ï¼šé€šè¿‡ TextMate è¯­æ³•å®šä¹‰
- **æ™ºèƒ½è¡¥å…¨**ï¼šCSS å±æ€§åã€å€¼çš„è‡ªåŠ¨è¡¥å…¨
- **æ‚¬åœæç¤º**ï¼šæ˜¾ç¤º CSS å±æ€§çš„æ–‡æ¡£
- **è·³è½¬åˆ°å®šä¹‰**ï¼šæ”¯æŒå˜é‡å’Œå¯¼å…¥çš„è·³è½¬
- **æŸ¥æ‰¾å¼•ç”¨**ï¼šæŸ¥æ‰¾æ ·å¼å˜é‡çš„æ‰€æœ‰å¼•ç”¨
- **è¯­ä¹‰ä»¤ç‰Œ**ï¼šæ›´ç²¾ç¡®çš„è¯­æ³•ç€è‰²
- **é”™è¯¯è¯Šæ–­**ï¼šå®æ—¶æ˜¾ç¤ºè¯­æ³•å’Œç±»å‹é”™è¯¯

### ç›®å½•ç»“æ„

```
cssts-language/
â”œâ”€â”€ cssts-language-server/     # è¯­è¨€æœåŠ¡å™¨
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ index.ts           # æœåŠ¡å™¨å…¥å£
â”‚       â”œâ”€â”€ CsstsLanguagePlugin.ts  # Volar è¯­è¨€æ’ä»¶
â”‚       â””â”€â”€ logutil.ts         # æ—¥å¿—å·¥å…·
â”œâ”€â”€ cssts-vscode-client/       # VSCode å®¢æˆ·ç«¯æ‰©å±•
â”‚   â””â”€â”€ src/
â”‚       â””â”€â”€ extension.ts       # æ‰©å±•å…¥å£
â”œâ”€â”€ syntaxes/                  # TextMate è¯­æ³•å®šä¹‰
â”‚   â””â”€â”€ cssts.tmLanguage.json
â”œâ”€â”€ examples/                  # ç¤ºä¾‹æ–‡ä»¶
â”‚   â””â”€â”€ demo.cssts
â”œâ”€â”€ language-configuration.json # è¯­è¨€é…ç½®ï¼ˆæ‹¬å·åŒ¹é…ã€æ³¨é‡Šç­‰ï¼‰
â”œâ”€â”€ package.json               # æ‰©å±•æ¸…å•
â”œâ”€â”€ tsdown.config.ts           # æ„å»ºé…ç½®
â””â”€â”€ README.md
```

### æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        VSCode                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  cssts-vscode-client (extension.ts)                      â”‚   â”‚
â”‚  â”‚  â€¢ å¯åŠ¨è¯­è¨€å®¢æˆ·ç«¯                                         â”‚   â”‚
â”‚  â”‚  â€¢ è¿æ¥è¯­è¨€æœåŠ¡å™¨                                         â”‚   â”‚
â”‚  â”‚  â€¢ è·å– TypeScript SDK è·¯å¾„                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â”‚ IPC                               â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  cssts-language-server (index.ts)                        â”‚   â”‚
â”‚  â”‚  â€¢ åŸºäº @volar/language-server                           â”‚   â”‚
â”‚  â”‚  â€¢ åˆ›å»º TypeScript é¡¹ç›®                                   â”‚   â”‚
â”‚  â”‚  â€¢ æ³¨å†Œè¯­è¨€æ’ä»¶                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  CsstsLanguagePlugin                                     â”‚   â”‚
â”‚  â”‚  â€¢ getLanguageId(): è¯†åˆ« .cssts æ–‡ä»¶                     â”‚   â”‚
â”‚  â”‚  â€¢ createVirtualCode(): åˆ›å»ºè™šæ‹Ÿ TypeScript ä»£ç          â”‚   â”‚
â”‚  â”‚  â€¢ typescript.extraFileExtensions: æ³¨å†Œ .cssts æ‰©å±•å   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å·¥ä½œåŸç†

1. **æ–‡ä»¶è¯†åˆ«**ï¼šå½“ç”¨æˆ·æ‰“å¼€ `.cssts` æ–‡ä»¶æ—¶ï¼ŒVSCode æ ¹æ® `package.json` ä¸­çš„è¯­è¨€é…ç½®è¯†åˆ«æ–‡ä»¶ç±»å‹

2. **è¯­æ³•é«˜äº®**ï¼šTextMate è¯­æ³•å®šä¹‰ (`cssts.tmLanguage.json`) æä¾›åŸºç¡€çš„è¯­æ³•ç€è‰²

3. **è¯­è¨€æœåŠ¡**ï¼š
   - å®¢æˆ·ç«¯å¯åŠ¨è¯­è¨€æœåŠ¡å™¨è¿›ç¨‹
   - æœåŠ¡å™¨åŠ è½½ `CsstsLanguagePlugin`
   - æ’ä»¶å°† `.cssts` æ–‡ä»¶æ˜ å°„ä¸ºè™šæ‹Ÿ TypeScript æ–‡ä»¶
   - TypeScript è¯­è¨€æœåŠ¡æä¾›æ™ºèƒ½åŠŸèƒ½

4. **è™šæ‹Ÿä»£ç æ˜ å°„**ï¼š
   - `.cssts` æ–‡ä»¶å†…å®¹ç›´æ¥ä½œä¸º TypeScript å¤„ç†
   - åˆ›å»º 1:1 çš„æºç æ˜ å°„
   - æ‰€æœ‰ TypeScript åŠŸèƒ½ï¼ˆè¡¥å…¨ã€è¯Šæ–­ç­‰ï¼‰è‡ªåŠ¨å¯ç”¨

### å¼€å‘

```bash
# è¿›å…¥ç›®å½•
cd cssts/cssts-language

# å®‰è£…ä¾èµ–
npm install

# æ„å»º
npm run build

# åœ¨ VSCode ä¸­æŒ‰ F5 å¯åŠ¨æ‰©å±•å¼€å‘ä¸»æœº
```

### æ‰“åŒ…å‘å¸ƒ

```bash
npm run package
# ç”Ÿæˆ cssts-language-x.x.x.vsix æ–‡ä»¶
```

### ä¾èµ–

- `@volar/language-core` - Volar è¯­è¨€æ ¸å¿ƒ
- `@volar/language-server` - Volar è¯­è¨€æœåŠ¡å™¨
- `@volar/vscode` - Volar VSCode é›†æˆ
- `volar-service-typescript` - TypeScript è¯­è¨€æœåŠ¡
- `vscode-languageclient` - LSP å®¢æˆ·ç«¯
- `vscode-languageserver` - LSP æœåŠ¡å™¨

---

## DTS ç±»å‹å®šä¹‰ç”Ÿæˆ

### æ¦‚è¿°

`cssts-compiler` æä¾› DTS ç”ŸæˆåŠŸèƒ½ï¼Œä¸ºåŸå­ç±»ç”Ÿæˆ TypeScript ç±»å‹å®šä¹‰æ–‡ä»¶ï¼Œå®ç° IDE æ™ºèƒ½æç¤ºã€‚

### æ ¸å¿ƒåŠŸèƒ½

- ç”Ÿæˆå…¨å±€å¸¸é‡å£°æ˜ï¼ˆ`declare const displayFlex`ï¼‰
- ç”¨æˆ·è¾“å…¥ `display` å³å¯è·å¾—æ‰€æœ‰ `display*` åŸå­ç±»çš„æç¤º
- æ”¯æŒå•æ–‡ä»¶å’Œåˆ†æ–‡ä»¶ä¸¤ç§æ¨¡å¼

### ä½¿ç”¨æ–¹å¼

```typescript
import { generateDtsFiles } from 'cssts-compiler';

// é»˜è®¤ï¼šå•æ–‡ä»¶æ¨¡å¼ï¼Œè¾“å‡ºåˆ° node_modules/@types/cssts-ts
generateDtsFiles();

// è‡ªå®šä¹‰é…ç½®
generateDtsFiles({
  outputDir: '/path/to/output',  // è¾“å‡ºç›®å½•
  splitFiles: false,              // æ˜¯å¦æ‹†åˆ†æ–‡ä»¶ï¼ˆé»˜è®¤ falseï¼‰
  verbose: true,                  // æ˜¯å¦æ‰“å°æ—¥å¿—
});
```

### è¾“å‡ºç›®å½•

| åœºæ™¯ | é»˜è®¤è¾“å‡ºç›®å½• |
|------|-------------|
| ç”Ÿäº§ç¯å¢ƒï¼ˆVite æ’ä»¶è°ƒç”¨ï¼‰ | `node_modules/@types/cssts-ts` |
| å¼€å‘ç¯å¢ƒï¼ˆCLI è°ƒè¯•ï¼‰ | `target/cssts-dts`ï¼ˆå¯é…ç½®ï¼‰ |

### æ–‡ä»¶æ¨¡å¼

#### å•æ–‡ä»¶æ¨¡å¼ï¼ˆé»˜è®¤ï¼Œ`splitFiles: false`ï¼‰

ç”Ÿæˆå•ä¸ª `index.d.ts` æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰åŸå­ç±»çš„å…¨å±€å¸¸é‡å£°æ˜ï¼š

```
node_modules/@types/cssts-ts/
â”œâ”€â”€ package.json
â””â”€â”€ index.d.ts      # æ‰€æœ‰ declare const å£°æ˜
```

```typescript
// index.d.ts
declare const displayFlex: { 'display_flex': true };
declare const displayBlock: { 'display_block': true };
declare const colorRed: { 'color_red': true };
// ... çº¦ 29754 ä¸ªåŸå­ç±»
```

**ä¼˜ç‚¹**ï¼š
- ç®€å•å¯é ï¼Œæ— è·¯å¾„é—®é¢˜
- TypeScript æ€§èƒ½æ— å·®å¼‚ï¼ˆç±»å‹æ•°é‡ç›¸åŒï¼‰
- æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ

#### åˆ†æ–‡ä»¶æ¨¡å¼ï¼ˆ`splitFiles: true`ï¼‰

æŒ‰å±æ€§æ‹†åˆ†ä¸ºå¤šä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨ `/// <reference>` å¼•å…¥ï¼š

```
target/cssts-dts/
â”œâ”€â”€ package.json
â”œâ”€â”€ index.d.ts          # reference å¼•å…¥æ‰€æœ‰åˆ†æ–‡ä»¶
â”œâ”€â”€ width.d.ts          # width ç›¸å…³åŸå­ç±»
â”œâ”€â”€ height.d.ts         # height ç›¸å…³åŸå­ç±»
â”œâ”€â”€ colors.d.ts         # é¢œè‰²ç›¸å…³åŸå­ç±»
â”œâ”€â”€ keywords.d.ts       # å…³é”®å­—åŸå­ç±»
â””â”€â”€ ...                 # å…¶ä»–å±æ€§æ–‡ä»¶
```

```typescript
// index.d.ts
/// <reference path="./width.d.ts" />
/// <reference path="./height.d.ts" />
/// <reference path="./colors.d.ts" />
// ...
```

**åˆ†ç±»è§„åˆ™**ï¼š
- æœ‰æ•°å€¼çš„å±æ€§ â†’ å•ç‹¬æ–‡ä»¶ï¼ˆå¦‚ `width.d.ts`ï¼‰
- æ— æ•°å€¼ä½†æœ‰é¢œè‰²ç±»å‹ â†’ `colors.d.ts`
- æ— æ•°å€¼æ— é¢œè‰² â†’ `keywords.d.ts`

**ä¼˜ç‚¹**ï¼š
- ä¾¿äºäººç±»é˜…è¯»å’Œè°ƒè¯•
- æ¨èç”¨äºå¼€å‘ç¯å¢ƒ

### CLI å·¥å…·

å¼€å‘è°ƒè¯•æ—¶ä½¿ç”¨ CLI ç”Ÿæˆåˆ†æ–‡ä»¶ç‰ˆæœ¬ï¼š

```bash
cd cssts/cssts/cssts-compiler
tsx src/dts/dts-cli.ts
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸš€ å¼€å§‹ç”Ÿæˆ .d.ts æ–‡ä»¶...

ğŸ“Š ç»Ÿè®¡ä¿¡æ¯:
   æ€»åŸå­ç±»æ•°: 29754
   å±æ€§æ•°: 94
   å•ä½ç±»å‹æ•°: 21

ğŸ“ ç”Ÿæˆåˆ†æ–‡ä»¶ç‰ˆæœ¬...
   âœ… ç”Ÿæˆ 52 ä¸ªæ•°å€¼å±æ€§æ–‡ä»¶
   âœ… ç”Ÿæˆ colors.d.ts (467 ä¸ªåŸå­ç±»)
   âœ… ç”Ÿæˆ keywords.d.ts (309 ä¸ªåŸå­ç±»)
   âœ… ç”Ÿæˆç´¢å¼•æ–‡ä»¶: index.d.ts

ğŸ‰ ç”Ÿæˆå®Œæˆ!
```

### è¿”å›å€¼

```typescript
interface DtsGenerateResult {
  files: string[];      // ç”Ÿæˆçš„æ–‡ä»¶è·¯å¾„åˆ—è¡¨
  atomCount: number;    // åŸå­ç±»æ€»æ•°
  stats: {
    totalAtoms: number;     // åŸå­ç±»æ€»æ•°
    propertyCount: number;  // CSS å±æ€§æ•°
    categoryCount: number;  // å•ä½ç±»å‹æ•°
  };
}
```

### è®¾è®¡å†³ç­–

**ä¸ºä»€ä¹ˆé»˜è®¤å•æ–‡ä»¶ï¼Ÿ**

1. **æ€§èƒ½æ— å·®å¼‚**ï¼šTypeScript ç¼–è¯‘å™¨ä¼šæŠŠæ‰€æœ‰ `.d.ts` åŠ è½½åˆ°å†…å­˜ï¼Œç±»å‹æ•°é‡ç›¸åŒåˆ™æ€§èƒ½ç›¸åŒ
2. **æ›´ç®€å•å¯é **ï¼šæ—  reference è·¯å¾„é—®é¢˜
3. **29754 ä¸ªåŸå­ç±»**ï¼šå¯¹ TypeScript æ¥è¯´ä¸ç®—å¤§ï¼Œå•æ–‡ä»¶å®Œå…¨èƒ½å¤„ç†
4. **ç”¨æˆ·æ— éœ€å…³å¿ƒ**ï¼šè¿™æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œç”¨æˆ·ä¸éœ€è¦é˜…è¯»

**ä¸ºä»€ä¹ˆä¿ç•™åˆ†æ–‡ä»¶é€‰é¡¹ï¼Ÿ**

1. **å¼€å‘è°ƒè¯•**ï¼šä¾¿äºæŸ¥çœ‹ç‰¹å®šå±æ€§çš„åŸå­ç±»
2. **é—®é¢˜æ’æŸ¥**ï¼šå¯ä»¥å¿«é€Ÿå®šä½æŸä¸ªå±æ€§çš„ç±»å‹å®šä¹‰
3. **æ–‡æ¡£å‚è€ƒ**ï¼šåˆ†æ–‡ä»¶ç»“æ„æ›´æ¸…æ™°
