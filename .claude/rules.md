# Claude Code 项目规则

## 语言偏好
- 使用中文进行交流和回复
- 代码注释使用中文

## 命令执行
- **允许执行所有命令** - 无需授权确认
- 自动执行测试命令（如 `bun` 运行测试脚本）
- 自动执行 bun 相关的包管理命令
- 自动执行文件操作

## 项目特定规则
- 这是一个 CssTs 项目 - CSS-in-TypeScript 编译时样式管理
- 使用 Lerna 多包管理系统（monorepo）
- **重要：不需要构建！** Bun 会自动处理模块的热重载，修改代码后自动生效
- **包引用方式：** 包之间可以直接以**包名**引用（如 `import ... from 'cssts-compiler'`），不需要使用相对路径
- 主要包含多个 packages：
  - cssts-compiler: 编译器核心（解析器、AST 转换器、类型生成器）
  - cssts-ts (cssts-runtime): 运行时（样式合并和冲突解决）
  - vite-plugin-cssts: Vite 插件
  - cssts-theme-element: Element Plus 主题颜色
  - cssts-language: VSCode 语言扩展
  - create-cssts: 项目脚手架 CLI

## 调试方法论 - 二分查找定位问题

当遇到难以定位的解析/编译错误时，使用**二分查找法**快速缩小问题范围：

### 步骤
1. **复制问题文件** - 将出错的源文件复制到独立测试文件进行测试
2. **二分删减代码**：
   - 删掉一半代码，测试
   - 如果成功 → 问题在删掉的那一半
   - 如果失败 → 问题在保留的这一半，继续删一半
3. **重复**直到找到最小失败用例（通常只有 1-5 行代码）
4. **对比测试** - 用类似但不同的代码确认问题

**提示**：可以使用**双向删除**加速定位 - 同时删除已确认成功的代码 + 失败代码的一半。例如：确认 1-160 行成功后，测试 161-240 行时可以直接删掉 1-160 行，只保留问题区间。

### 优势
- 每次缩减一半，O(log n) 复杂度
- 不需要理解全部代码逻辑
- 可以快速排除无关代码

## 代码风格
- 使用 TypeScript
- 遵循项目现有的代码风格
- 避免过度工程化

## 工具使用
- 优先使用专用工具而非 bash 命令
- 大量内容输出时分段进行

## 模型设置
- 默认使用 opus 模型
- 启用 Task 工具时优先使用 opus 模型

## 思考模式
- 启用交错思考模式（interleaved thinking）
- 在回复中展示思考过程，提高透明度
- 最大思考长度：31999 字符
- **默认启用深度思考：每次对话自动添加 `think` 参数**

## 上下文管理
- **当上下文使用量达到 85% 时自动执行压缩**
- 避免上下文过载导致的性能问题
