/**
 * Button Component (OVS)
 * 
 * Element Plus 风格的按钮组件
 * 使用 OVS 语法 + cssts css {} 表达式
 */

import { computed } from 'vue'

view Button(props) {
  // 按钮基础样式 - css {} 编译为字符串
  const baseStyle = css {
    inlineFlex,
    justifyCenter,
    itemsCenter,
    height32,
    paddingSm,
    fontSize14,
    fontMedium,
    border,
    rounded,
    cursorPointer,
    transition,
    selectNone,
    outlineNone
  }
  
  // 类型样式映射
  const typeStyles = {
    default: css { bgWhite, colorRegular, borderBase },
    primary: css { bgPrimary, colorWhite, borderPrimary },
    success: css { bgSuccess, colorWhite, borderSuccess },
    warning: css { bgWarning, colorWhite, borderWarning },
    danger: css { bgDanger, colorWhite, borderDanger },
    info: css { bgInfo, colorWhite, borderInfo }
  }
  
  // 计算完整类名
  const buttonClass = computed(() => {
    const classes = [baseStyle]
    
    // 类型样式
    const type = props.type || 'default'
    classes.push(typeStyles[type] || typeStyles.default)
    
    // 状态样式
    if (props.disabled) classes.push(css { isDisabled, cursorNotAllowed })
    if (props.loading) classes.push(css { isLoading })
    if (props.round) classes.push(css { roundedFull })
    if (props.circle) classes.push(css { roundedFull, paddingCircle })
    if (props.text) classes.push(css { isText })
    if (props.link) classes.push(css { isLink })
    
    return classes.join(' ')
  })

  // 点击处理
  const handleClick = (evt) => {
    if (props.disabled || props.loading) {
      evt.stopPropagation()
      return
    }
    if (props.onClick) {
      props.onClick(evt)
    }
  }

  // 渲染
  button(
    class = buttonClass.value,
    disabled = props.disabled || undefined,
    type = props.nativeType || 'button',
    onClick = handleClick
  ) {
    // 加载图标
    if (props.loading) {
      span(class = css { marginRight6, animationRotating }) { '⟳' }
    }
    
    // 子内容
    span() {
      props.children
    }
  }
}

export default Button
