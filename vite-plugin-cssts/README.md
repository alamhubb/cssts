# vite-plugin-cssts

> Vite 插件，用于处理 `.cssts` 和 `.cssts.js` 文件并按需生成原子类 CSS

## ⚠️ 重要：伪类分隔符是双美元符号 `$$`

```javascript
// ✅ 正确：使用双美元符号 $$
const btn$$hover$$active = css { cursorPointer }

// ❌ 错误：使用单美元符号 $（伪类不会生效！）
const btn$hover$active = css { cursorPointer }
```

分隔符配置来自 `cssts-runtime`：`CSSTS_CONFIG.PSEUDO_SEPARATOR = '$$'`

---

## 支持的文件类型

- `.cssts` - 专用的 cssts 样式文件
- `.cssts.js` - 在 JS 文件中使用 css {} 语法（可在 Vue 组件中导入）

## 核心职责

vite-plugin-cssts 是一个**薄层插件**，只负责 Vite 集成：

1. **调用 cssts-compiler** - 转换 `.cssts` 和 `.cssts.js` 文件
2. **虚拟模块管理** - 提供 `virtual:csstsAtom` 和 `virtual:cssts.css`
3. **HMR 处理** - 热更新支持

所有核心逻辑都在 `cssts-compiler` 中。

## 安装

```bash
npm install vite-plugin-cssts -D
```

## 使用

### 配置 Vite

```javascript
// vite.config.js
import { defineConfig } from 'vite'
import cssTsPlugin from 'vite-plugin-cssts'

export default defineConfig({
  plugins: [
    cssTsPlugin({
      classPrefix: '', // 可选：CSS 类名前缀
      include: ['.cssts', '.cssts.js'], // 处理的文件扩展名
      pseudoUtils: {   // 可选：$$ 伪类配置
        hover: { filter: 'brightness(1.15)' },
        active: { filter: 'brightness(0.85)' },
        focus: { outline: '2px solid blue' }
      }
    }),
  ],
  // 配置 esbuild 跳过 .cssts.js 文件的依赖扫描
  optimizeDeps: {
    esbuildOptions: {
      plugins: [
        {
          name: 'cssts-js-loader',
          setup(build) {
            build.onLoad({ filter: /\.cssts\.js$/ }, () => ({
              contents: 'export default {}',
              loader: 'js'
            }))
          }
        }
      ]
    }
  }
})
```

### 在 .cssts 文件中使用

```javascript
// Button.cssts

// 普通样式
const buttonStyle = css { displayFlex, padding16px }

// 带伪类的样式（使用 $$ 双美元符号）
const clickable$$hover$$active = css { displayFlex, cursorPointer }
```

### 在 .cssts.js 文件中使用（推荐用于 Vue 项目）

```javascript
// Button.cssts.js

// 基础样式
export const baseStyles = css {
  displayInlineFlex,
  padding8px,
  borderRadius4px
}

// 带伪类的样式（使用 $$ 双美元符号）
export const primary$$hover$$active = css {
  baseStyles,
  backgroundColorDodgerblue,
  colorWhite
}
```

然后在 Vue 组件中导入：

```vue
<script setup>
import { primary$$hover$$active } from './Button.cssts.js'
</script>

<template>
  <button :class="primary$$hover$$active">Click me</button>
</template>
```

## 配置选项

| 选项 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `classPrefix` | `string` | `''` | CSS 类名前缀 |
| `include` | `string[]` | `['.cssts']` | 处理的文件扩展名 |
| `pseudoUtils` | `PseudoUtilsConfig` | `undefined` | $$ 伪类配置 |
| `globalStyles` | `Set<string>` | 内部创建 | 共享的样式集合 |

## 生成的虚拟模块

### virtual:csstsAtom

包含项目中使用的所有样式：

```javascript
export const csstsAtom = {
  // 普通原子类
  displayFlex: { 'display_flex': true },
  // 带伪类的样式
  'primary$$hover$$active': { 'primary': true },
}
```

### virtual:cssts.css

按需生成的 CSS：

```css
/* Auto-generated by cssts-compiler */

/* display */
.display_flex { display: flex; }

/* $$ Pseudo-class styles */
.primary:hover { filter: brightness(1.15); }
.primary:active { filter: brightness(0.85); }
```

## 分隔符配置

分隔符统一在 `cssts-runtime` 中配置：

```javascript
import { CSSTS_CONFIG } from 'cssts-runtime'

CSSTS_CONFIG.SEPARATOR        // '_'   - 类名分隔符
CSSTS_CONFIG.PSEUDO_SEPARATOR // '$$'  - 伪类分隔符（双美元符号）
```

## License

MIT
