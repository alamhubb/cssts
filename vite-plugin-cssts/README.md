# vite-plugin-cssts

> Vite 插件，用于处理 `css {}` 语法并按需生成原子类 CSS

## 核心特性

- **按需生成** - 只生成项目中使用的原子类 CSS
- **虚拟模块** - CSS 在内存中生成，无需管理文件
- **HMR 支持** - 开发时样式即时更新
- **统一命名规范** - 遵循 `property_value` 命名规范

## 安装

```bash
npm install vite-plugin-cssts -D
```

## 使用

### 1. 配置 Vite

```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import cssTsPlugin from 'vite-plugin-cssts'

export default defineConfig({
  plugins: [
    cssTsPlugin({
      classPrefix: 'cu-', // 可选：CSS 类名前缀
    }),
  ],
})
```

### 2. 导入虚拟 CSS 模块

在入口文件中导入虚拟 CSS 模块：

```typescript
// main.ts
import 'virtual:cssts.css'
```

### 3. 使用 css {} 语法

```typescript
// 在 .ovs 或 .cssts 文件中使用
const buttonStyle = css {
  displayFlex,
  alignItemsCenter,
  padding16px,
  backgroundColorBlue
}
```

## 命名规范

本插件遵循 CssTs 统一命名规范（详见 `cssts-types/README.md`）：

### CSS 类名格式

采用 `{property}_{value}` 格式，用 `_` 下划线分隔属性和值：

```css
.display_flex { display: flex; }
.justify-content_center { justify-content: center; }
.padding-top_16px { padding-top: 16px; }
.height_32px { height: 32px; }
```

**为什么用 `_` 分隔？**

CSS 属性名和值都可能包含 `-`，如果统一用 `-` 会产生歧义：
```
justify-content-flex-start  // 歧义：哪里是属性和值的分界？
justify-content_flex-start  // 清晰：_ 左边是属性，右边是值
```

### TypeScript 变量名格式

采用 `{property}{Value}` 的 camelCase 格式：

| TS 变量名 | CSS 类名 | CSS 规则 |
|-----------|----------|----------|
| `displayFlex` | `.display_flex` | `display: flex` |
| `justifyContentCenter` | `.justify-content_center` | `justify-content: center` |
| `paddingTop16px` | `.padding-top_16px` | `padding-top: 16px` |
| `height32px` | `.height_32px` | `height: 32px` |

**重要：数值必须带单位！**
```typescript
// ✅ 正确
height32px, fontSize14px, paddingLeft15px

// ❌ 错误（缺少单位）
height32, fontSize14, paddingLeft15
```

### 特殊符号转换

| CSS 值 | TS 变量名 | CSS 类名 |
|--------|-----------|----------|
| `1.5` | `lineHeight1p5` | `.line-height_1\.5` |
| `50%` | `width50pct` | `.width_50\%` |
| `-1` | `zIndexN1` | `.z-index_-1` |
| `16/9` | `aspectRatio16s9` | `.aspect-ratio_16\/9` |

符号别名（TS 标识符）：
- `.` → `p` (point，小数点)
- `%` → `pct` (percent，百分号)
- `/` → `s` (slash，斜杠)
- `-` → `N` (negative，负数前缀)

## 工作流程

### 开发模式 (vite dev)

```
用户修改 .cssts/.ovs 文件
        ↓
插件 transform 钩子处理文件
        ↓
收集使用的原子类到 globalUsedAtoms
        ↓
virtual:cssts.css 模块返回生成的 CSS
        ↓
HMR 自动更新样式（无需刷新页面）
```

### 生产构建 (vite build)

```
扫描所有 .cssts/.ovs 文件
        ↓
收集所有原子类
        ↓
virtual:cssts.css 生成最终 CSS
        ↓
Vite 自动打包到 dist
```

## 虚拟模块说明

`virtual:cssts.css` 是一个虚拟模块，CSS 内容完全在内存中生成，不会写入文件系统。

优点：
- 无需管理生成的 CSS 文件
- 开发时 HMR 即时更新
- 构建时自动优化和打包
- 类似 UnoCSS / Tailwind CSS 的工作方式

## 与 vite-plugin-ovs 集成

`vite-plugin-ovs` 内部集成了本插件，用户只需配置 OVS 插件即可：

```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import ovs from 'vite-plugin-ovs'

export default defineConfig({
  plugins: [
    vue(),
    ovs({
      cssts: {
        classPrefix: 'cu-', // 透传给 vite-plugin-cssts
      }
    })
  ]
})
```

OVS 插件会：
1. 处理 `.ovs` 文件中的 `css {}` 语法
2. 收集使用的原子类
3. 自动注入 `virtual:cssts.css` 导入
4. 透传配置给 cssts 插件生成 CSS

## 配置选项

| 选项 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `dtsOutput` | `string` | `'src/cssts/CssCls.d.ts'` | 生成的类型文件路径 |
| `stylesOutput` | `string` | `'src/cssts/CssCls.styles.ts'` | 生成的样式文件路径 |
| `atomOutput` | `string` | `'src/cssts/CsstsAtom.ts'` | 生成的原子类文件路径 |
| `autoGenerate` | `boolean` | `true` | 是否在开发模式下自动生成文件 |
| `transformClass` | `boolean` | `true` | 是否自动转换 Vue template 中的 :class 语法 |
| `runtimeImport` | `string` | `'./cssts/runtime'` | cssts runtime 的导入路径 |
| `atomImport` | `string` | `'./cssts/CsstsAtom'` | csstsAtom 的导入路径 |
| `classPrefix` | `string` | `''` | CSS 类名前缀 |

## 生成的 CSS 示例

```css
/* Auto-generated by vite-plugin-cssts */

/* align-items */
.align-items_center { align-items: center; }
.align-items_flex-start { align-items: flex-start; }

/* display */
.display_flex { display: flex; }
.display_inline-flex { display: inline-flex; }

/* height */
.height_32px { height: 32px; }
.height_100pct { height: 100%; }

/* justify-content */
.justify-content_center { justify-content: center; }
.justify-content_space-between { justify-content: space-between; }

/* padding */
.padding-left_15px { padding-left: 15px; }
.padding-right_15px { padding-right: 15px; }
```

## 导出 API

本插件导出以下 API 供其他插件（如 vite-plugin-ovs）使用：

```typescript
import cssTsPlugin, { 
  globalUsedAtoms,  // 全局原子类收集器
  VIRTUAL_CSS_ID    // 虚拟模块 ID
} from 'vite-plugin-cssts'
```

## License

MIT
